<!DOCTYPE html>
<html>


<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>GeoTek 2020</title>


    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="https://fonts.googleapis.com/css?family=Syncopate&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

    <!-- Load the Chart.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
    <script src="moment.js"></script>

    <link rel="stylesheet" href="https://js.arcgis.com/4.14/esri/themes/dark-blue/main.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" />
    <script src="https://js.arcgis.com/4.14/"></script>

</head>


<body>

    <button class="esri-button" id="slice" type="button" title="Slice layers">
        Tverrsnitt
    </button>

   
        <div class="title-overlay"><svg width="242px" height="80px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 108 36"><g fill="#FFFFFF"><path d="M44.13 20.38a.23.23 0 0 0-.25-.24h-1.63a.48.48 0 0 1-.48-.48v-2.29c0-.26.21-.48.48-.48h4.7c.26 0 .48.22.48.48v4.05c0 2.9-2.43 5.27-5.74 5.27-3.3 0-5.4-2.43-5.73-5.32a31.6 31.6 0 0 1 0-6.75c.34-2.9 2.4-5.33 5.73-5.33 3.33 0 5.74 2.29 5.74 5.5v.02a.5.5 0 0 1-.48.48h-2.4a.48.48 0 0 1-.49-.48v-.02c0-1-.84-2.1-2.36-2.1-1.47 0-2.22.87-2.34 1.93-.24 2.24-.24 4.5 0 6.75.12 1.06.87 1.93 2.34 1.93 1.47 0 2.43-.8 2.43-1.88v-1.04zm9.28 2.44a.23.23 0 0 0 .24.24h5.7c.27 0 .49.22.49.48v2.41c0 .27-.22.48-.48.48H50.5a.48.48 0 0 1-.48-.48v-15.9c0-.27.22-.49.48-.49h8.76c.27 0 .48.22.48.49v2.4c0 .27-.21.49-.48.49h-5.62a.23.23 0 0 0-.24.24v2.89a.23.23 0 0 0 .24.24h5.42c.27 0 .48.22.48.48v2.41c0 .27-.21.48-.48.48h-5.42a.23.23 0 0 0-.24.24v2.9zm20.15-8.2c.24 2.25.24 4.51 0 6.75-.34 2.9-2.41 5.33-5.74 5.33s-5.4-2.43-5.74-5.33a31.6 31.6 0 0 1 0-6.74c.34-2.9 2.41-5.33 5.74-5.33s5.4 2.43 5.74 5.33zm-3.4 6.75c.24-2.24.24-4.5 0-6.74-.12-1.06-.87-1.93-2.34-1.93-1.47 0-2.22.86-2.34 1.93-.24 2.24-.24 4.5 0 6.74.12 1.06.87 1.93 2.34 1.93 1.47 0 2.22-.87 2.34-1.93zm10.58-10.02v14.6c0 .27-.22.48-.48.48h-.6a.48.48 0 0 1-.49-.48v-14.6a.23.23 0 0 0-.24-.24h-3.57a.48.48 0 0 1-.48-.48v-.58c0-.27.22-.49.48-.49h9.16c.27 0 .48.22.49.49v.57c0 .27-.22.48-.49.49h-3.54a.23.23 0 0 0-.24.24zm7.42 13.3a.23.23 0 0 0 .24.24h6.3c.26 0 .47.22.48.48v.58c0 .27-.22.48-.49.48H87.1a.48.48 0 0 1-.48-.48v-15.9c0-.27.22-.49.48-.49h7.54c.27 0 .49.22.49.49v.57c0 .27-.22.48-.49.49H88.4a.23.23 0 0 0-.24.24v5.47a.23.23 0 0 0 .24.24h5.98c.27 0 .48.22.48.48v.55c0 .26-.21.48-.48.48H88.4a.23.23 0 0 0-.24.24v5.84zm11.52-5.42c-.04-.07-.19-.07-.19.05v6.67c0 .27-.22.48-.48.49h-.58a.48.48 0 0 1-.48-.49v-15.9c0-.27.21-.49.48-.49h.58c.26 0 .48.22.48.49v6.36c0 .12.15.12.2.05l5.54-6.63a.76.76 0 0 1 .62-.26h.39c.58 0 .7.53.4.86l-5.94 7.02c-.15.2-.22.37-.03.58l6.37 7.52c.26.31.19.9-.44.9h-.53a.8.8 0 0 1-.63-.32l-5.76-6.9zM25.18 4.14L16.63 8.4.06.12V17.3l4 2v8.03l4.02 2 .46.23 12.6 6.3.03-12.58 3.99-1.99.03-17.16zM20.16 22.7l-3.02 1.5.01-6.37 3.02 1.5v3.37zM9.1 21.82l6.39 3.2-6.4 3.18.01-6.38zm7.04 2.4L9.09 20.7v-6.91l7.05 3.52-.01 6.9zm-8.04-4.03l-3.02-1.5v-6.91l3.02 1.5v6.91zm1.6-7.23l6.48-3.21-.02 6.44-6.46-3.23zM1.05 16.7V1.74L15.5 8.96 8.55 12.4l-4.49-2.24v8.03l-3-1.5zm4 10.04v-6.91l3.02 1.5v6.91l-3.02-1.5zm15.07 7.53L9.66 29.03l6.93-3.46.53-.26 3.03-1.5-.03 10.45zm4.02-13.57l-2.98 1.5V18.7l-4.02-2.01.01-7.45 7.03-3.48-.04 14.92z"></path></g></svg></div>
 

    <div id="viewDiv">

    </div>

   

    <div id="menu" class="esri-widget">
        <p>Filtrere p√• etasje:</p>
        <div id="floorSelector"></div>
        <button id="filterReset" class="esri-button">Fjern filter</button>
    </div>


    <script>
        require([
                "esri/Map",
                "esri/WebScene",
                "esri/views/SceneView",
                "esri/Basemap",
                "esri/layers/Layer",
                "esri/layers/SceneLayer",
                "esri/layers/BuildingSceneLayer",
                "esri/layers/FeatureLayer",
                "esri/layers/ElevationLayer",
                "esri/layers/GraphicsLayer",
                "esri/widgets/Sketch/SketchViewModel",
                "esri/symbols/WebStyleSymbol",
                "esri/views/layers/support/FeatureFilter",
                "esri/geometry/geometryEngine",
                "esri/Graphic",
                "esri/renderers/ClassBreaksRenderer",
                "esri/widgets/Slider",
                "esri/core/promiseUtils",
                "esri/widgets/LayerList",
                "esri/widgets/Expand",
                "esri/widgets/Slice",
                "esri/layers/support/BuildingFilter",
                "esri/renderers/UniqueValueRenderer"
            ],
            function(Map, WebScene, SceneView, Basemap, Layer, SceneLayer, BuildingSceneLayer, FeatureLayer, ElevationLayer, GraphicsLayer, SketchViewModel, WebStyleSymbol, Graphic, geometryEngine, FeatureFilter, ClassBreaksRenderer, Slider, promiseUtils, LayerList, Expand, Slice, BuildingFilter, UniqueValueRenderer) {


                const defExpression = "byggnr <> 81809542 AND byggnr <> 81809569 AND byggnr <> 81809488 AND byggnr <> 300229671";
                const defExpressionHiglight = "byggnr = 81809542 or byggnr = 81809569 or byggnr = 81809488 or byggnr = 80725728 or byggnr = 80772092 or byggnr = 80835337 or byggnr = 81050821 or byggnr = 81097607";


                //-------------------RENDERS------------------------------------------------------


                //--------Polyrendrer - Simple---------------------
                var polyrend = {
                    type: "simple",
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()

                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#f44141",

                            },
                            edges: {
                                type: "solid",
                                color: "#4d5b18",
                                size: 1.5
                            },
                            size: 5.6,
                            opacity: 0.8
                        }]
                    }
                };
                //-------------------------------------------------------------------------------

                //--------Polyrendrer - Edge---------------------
                var EdgeRenderer = {
                    type: "simple", // autocasts as new SimpleRenderer()
                    // Add a default MeshSymbol3D. The color will be determined
                    // by the visual variables
                    symbol: {
                        type: "mesh-3d",
                        symbolLayers: [{
                            type: "fill",
                            material: {
                                color: [255, 255, 255, 0.3],
                                colorMixMode: "replace"
                            },
                            edges: {
                                type: "solid",
                                color: [0, 0, 0],
                                size: 1.5
                            }
                        }]
                    },
                };

                //-------------------------------------------------------------------------------

                //--------Polyrendrer ROM - prox---------------------
                var NotPresentSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [0, 255, 0, 0.3],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 3
                    }]
                };

                var PresentSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [255, 0, 0, 0.3],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 3
                    }]
                };

                var DisTechRendrerPROX = {
                    type: "unique-value", // autocasts as new UniqueValueRenderer()
                    defaultSymbol: {
                        type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ExtrudeSymbol3DLayer()
                            material: {
                                color: [204, 204, 204, 0.3],
                            },
                            edges: {
                                type: "solid",
                                color: "#333333",
                                size: 1.5
                            },
                            size: 1.5
                        }]
                    },
                    defaultLabel: "Other",
                    field: "Status",
                    uniqueValueInfos: [{
                        value: "PRESENT",
                        symbol: PresentSymbol,
                        label: "PresentSymbol"
                    }, {
                        value: "NOT_PRESENT",
                        symbol: NotPresentSymbol,
                        label: "NOT_PRESENT"
                    }],

                };
                //-----------------------------------------------

                //--------Polyrendrer ROM - Booking---------------------   
                var LedigSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [87, 214, 141, 0.8],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 3
                    }]
                };

                var OpptattSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [192, 57, 43, 0.8],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 3
                    }]
                };
                var RomBooking = {
                    type: "unique-value", // autocasts as new UniqueValueRenderer()
                    defaultSymbol: {
                        type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ExtrudeSymbol3DLayer()
                            material: {
                                color: [204, 204, 204, 0.8],
                            },
                            edges: {
                                type: "solid",
                                color: "#333333",
                                size: 1.5
                            },
                            size: 1.5
                        }]
                    },
                    defaultLabel: "Other",
                    field: "Tilgjengelighet",
                    uniqueValueInfos: [{
                        value: "Opptatt",
                        symbol: OpptattSymbol,
                        label: "OpptattSymbol"
                    }, {
                        value: "Ledig",
                        symbol: LedigSymbol,
                        label: "LedigSymbol"
                    }],

                };
                //-----------------------------------------------


                //--------Polyrendrer Plass - prox---------------------
                var NotPresentSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [6, 126, 183, 0.7],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 1
                    }]
                };

                var PresentSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [244, 112, 102, 0.7],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 1.5
                    }]
                };

                var DisTechRendrerPROXplass = {
                    type: "unique-value", // autocasts as new UniqueValueRenderer()
                    defaultSymbol: {
                        type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ExtrudeSymbol3DLayer()
                            material: {
                                color: [6, 126, 183, 0.7],
                            },
                            edges: {
                                type: "solid",
                                color: "#333333",
                                size: 1.5
                            },
                            size: 1
                        }]
                    },
                    defaultLabel: "Other",
                    field: "Status",
                    uniqueValueInfos: [{
                        value: "PRESENT",
                        symbol: PresentSymbol,
                        label: "PresentSymbol"
                    }, {
                        value: "NOT_PRESENT",
                        symbol: NotPresentSymbol,
                        label: "NOT_PRESENT"
                    }],

                };
                //-----------------------------------------------


                //--------Polyrendrer - Temp---------------------
                var FlateRendererDistTech = new ClassBreaksRenderer({
                    // type: "class-breaks",
                    // attribute of interest - Earthquake magnitude
                    valueExpression: "if ( $feature.ETASJE_TOPOLOGISK == 2) {return 0} else {return $feature.Temp}"
                });

                // All features with magnitude between 0 - 4.0
                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 0.0,
                    maxValue: 1.0,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#4286f4"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 1.0,
                    maxValue: 1.75,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#ec1d23"
                            },
                            size: 5.6
                        }]
                    }
                });

                // All features with magnitude between 4.1 - 7.0
                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 1.76,
                    maxValue: 2.5,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#f37b7d"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 23,
                    maxValue: 24.5,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#42f480"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 24.6,
                    maxValue: 50,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#e50d18"
                            },
                            size: 5.6
                        }]
                    }
                });



                var FlateRendererNordigi = new ClassBreaksRenderer({
                    // type: "class-breaks",
                    // attribute of interest - Earthquake magnitude
                    valueExpression: "if ( $feature.ETASJE_TOPOLOGISK == 2) {return 0} else {return $feature.Temp}"
                });

                // All features with magnitude between 0 - 4.0
                FlateRendererNordigi.addClassBreakInfo({
                    minValue: 0.0,
                    maxValue: 10,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#4286f4"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererNordigi.addClassBreakInfo({
                    minValue: 10.1,
                    maxValue: 100,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#ec1d23"
                            },
                            size: 5.6
                        }]
                    }
                });
                //-----------------------------------------------

                //--------ekisterendeBygg---------------------
                var solidEdges = {
                    type: "solid",
                    color: [0, 0, 0],
                    size: 1
                };

                var byggRenderer = {
                    type: "simple", // autocasts as new SimpleRenderer()
                    symbol: {
                        type: "mesh-3d",
                        symbolLayers: [{
                            type: "fill",
                            material: {
                                color: "#ffffff",
                                colorMixMode: "replace"
                            },
                            edges: solidEdges
                        }]
                    },
                };

                var byggRendererHiglight = {
                    type: "simple", // autocasts as new SimpleRenderer()
                    symbol: {
                        type: "mesh-3d",
                        symbolLayers: [{
                            type: "fill",
                            material: {
                                color: "#42ebf4",
                                colorMixMode: "replace"
                            },
                            edges: solidEdges
                        }]
                    },
                };



                //---------------------------------------------------------------------------------

                //--------LedningsRendrer---------------------

                const roundTubeSymbol = {
                    type: "line-3d",
                    symbolLayers: [{
                      type: "path",
                      profile: "circle",
                      material: {
                        color: [100, 100, 100]
                      },
                      width: 30, // the width in m
                      height: 30 // the height in m
                    }]
                  };

                  var symbolLine = {
                    type: "line-3d",  // autocasts as new LineSymbol3D()
                    symbolLayers: [{
                        type: "path",  // autocasts as new PathSymbol3DLayer()
                        size: 20,  // 20 meters in diameter
                        material: { color: "#ff7380" }
                    }]
                };

                //---------------------------------------------------------------------------------



                //--------PersonRendrer---------------------


                var verticalOffset = {
                    screenLength: 250,
                    maxWorldLength: 30,
                    minWorldLength: 2
                };


                function getUniqueValueSymbol(name, color) {
                    // The point symbol is visualized with an icon symbol. To clearly see the location of the point
                    // we displace the icon vertically and add a callout line. The line connects the offseted symbol with the location
                    // of the point feature.
                    return {
                        type: "point-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "icon", // autocasts as new IconSymbol3DLayer()
                            resource: {
                                href: name
                            },
                            size: 50,
                            outline: {
                                color: "white",
                                size: 10
                            }
                        }],

                        verticalOffset: verticalOffset,

                        callout: {
                            type: "line", // autocasts as new LineCallout3D()
                            color: "white",
                            size: 1,
                            border: {
                                color: color
                            }
                        }
                    };
                }

                var pointsRenderer = {
                    type: "unique-value", // autocasts as new UniqueValueRenderer()
                    field: "DeviceID",
                    uniqueValueInfos: [{
                        value: "7E30CC70-35A5-4EDB-8304-E78F9AFD3E5E",
                        symbol: getUniqueValueSymbol("data:image/png;base64,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", "#42f4a4")

                    }]
                };


                //---------------------------------------------------------------------------------



                //-----------------------LAG------------------------------------------------------

                const sketchLayer = new GraphicsLayer();


                const person_sensor = new FeatureLayer({
                        url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/Forkbeard_siste_posisjon/FeatureServer/0",
                        title: "Arbeidere",
                        //listMode: "hide",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: pointsRenderer,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 8
                        },

                    }

                );

                const Ledningsnett = new FeatureLayer({
                    url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/Hotell_Oslo/FeatureServer/0",
                    title: "Ledningsnett",
                    visible: false,
                    outFields: ["*"],
                    purgeOptions: {
                        displayCount: 1000
                    },
                    renderer: roundTubeSymbol,
                    opacity: 0.8,

                    //popupTemplate: template,
                    refreshInterval: 0.01,
                    elevationInfo: {
                        // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                        mode: "absolute-height",
                        offset: 1
                    },

                }

            );

                const Scene = new SceneLayer({
                        url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/scene_geotek2020/SceneServer",
                        title: "Scene",
                        //visible: false,
                        //listMode: "hide",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 5.7
                        },

                    }

                );
                const Stoler = new SceneLayer({
                        url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/stol_scandicOpera/SceneServer",
                        title: "Stoler",
                        //visible: false,
                        //listMode: "hide",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 8.1
                        },

                    }

                );

                const Stoler_sensor = new FeatureLayer({
                        url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/proxSensorBuffer_geotek2020/FeatureServer",
                        title: "Stol_sensor",
                        visible: false,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: DisTechRendrerPROXplass,
                        opacity: 0.8,

                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 8.1
                        },

                    }

                );


                const hotellBIM = new BuildingSceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/ScandicHotellOpera03/SceneServer", //"https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_plan/SceneServer",
                        title: "BIM - S28",
                        visible: true,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 0
                        },

                    }

                );

                const Bygninger_Norge_Oslo = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/PdUYt91ohJfR04kk/arcgis/rest/services/Bygninger_Norge_OsloSommerkonf_20180730_124537/SceneServer",
                        title: "Bygninger",
                        definitionExpression: defExpression,
                        outFields: ["*"],
                        visible: false,
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: byggRenderer,
                        opacity: 0.25,

                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "on-the-ground",
                            //offset: 2.8
                        },

                    }

                );

                var basemap = new Basemap({
                    portalItem: {
                        id: "a1f189886ef54c5b8e03e37695e8925d" // WGS84 Streets Vector webmap
                    }
                });

                var elevLyr = new ElevationLayer({
                    portalItem: {
                        id: "4526a4d94b844467a3ce130da8ca172d"
                    }
                });

                const gLayer = new GraphicsLayer();

                var map = new Map({
                    //basemap: basemap,
                    //ground: "world-elevation",
                    layers: [hotellBIM, Ledningsnett, Bygninger_Norge_Oslo, Stoler_sensor, person_sensor, Stoler, Scene],
                    ground: {
                        surfaceColor: "#2A363B"
                    }
                });


                map.ground.layers.add(elevLyr);

                var view = new SceneView({
                    container: "viewDiv",
                    map: map,
                    alphaCompositingEnabled: true,
                    environment: {
                        background: {
                            type: "color", // autocasts as new ColorBackground()
                            color: "#2A282B"
                        },
                        lighting: {
                            directShadowsEnabled: true,
                            ambientOcclusionEnabled: true
                          },
                        // disable stars
                        starsEnabled: false,
                        //disable atmosphere
                        atmosphereEnabled: true
                    },
                    qualityProfile: "high",
                    center: {
                        x: 262744.68078,
                        y: 6648750.9098,
                        z: 100,
                        spatialReference: 25833
                    }

                });

                view.when(function() {
                    var layerList = new LayerList({
                        view: view
                    });

                    var bgExpand = new Expand({
                        view: view,
                        content: layerList
                    });


                    // Add widget to the top right corner of the view
                    view.ui.add(bgExpand, "top-left");
                });


                const excludedLayers = [];
                let doorsLayer;

                hotellBIM.when(function() {
                    // Iterate through the flat array of sublayers and extract the ones
                    // that should be excluded from the slice widget
                    hotellBIM.allSublayers.forEach(function(layer) {
                        // modelName is standard accross all BuildingSceneLayer,
                        // use it to identify a certain layer
                        switch (layer.modelName) {
                            // Because of performance reasons, the Full Model view is
                            // by default set to false. In this scene the Full Model should be visible.
                            case "FullModel":
                                layer.visible = true;
                                break;
                            case "Overview":
                                layer.visible = false;
                                break;
                            case "Mass":
                                layer.visible = false;
                                break;
                            case "Rooms":
                                layer.visible = false;
                                break;
                            case "GenericModel":
                                layer.visible = false;
                                break;


                                // Extract the layers that should not be hidden by the slice widget
                            case "Doors":
                                doorsLayer = layer;
                                excludedLayers.push(layer);
                            case "StructuralColumns":
                            case "Floors":
                            case "Furniture":
                                //case "CurtainWallPanels":
                                excludedLayers.push(layer);
                                break;
                            default:
                                layer.visible = true;
                        }
                    });
                });

                view.when(function() {



                    // define a floor filter
                    const buildingFilter = new BuildingFilter({
                        filterBlocks: [{
                            // an SQL expression that filters using the BldgLevel field
                            filterExpression: "BldgLevel_Desc = '02'",
                            filterMode: {
                                type: "solid"
                            }
                        }]
                    });
                    // set the filter in the filters array on the layer
                    hotellBIM.filters = [buildingFilter];
                    // specify which filter is the one that should be applied
                    hotellBIM.activeFilterId = buildingFilter.id;
                }).catch(console.error);

                // define a slider that will filter floors
                const floorSlider = new Slider({
                    container: "floorSelector",
                    min: 1,
                    max: 9,
                    precision: 0,
                    layout: "vertical",
                    steps: 1,
                    tickConfigs: [{
                        mode: "position",
                        values: [01, 02, 03, 04, 05, 06, 07, 08, 09],
                        labelsVisible: true
                    }],
                    values: [2]
                });

                // when the user changes the value, the filter is cloned and a new expression is set
                floorSlider.watch("values", function(values) {
                    console.log("VAL: ", values)
                    const filter = hotellBIM.filters.getItemAt(0).clone();
                    let newFilterExpression = "BldgLevel_Desc = '0" + values[0].toString() + "'";
                    console.log(newFilterExpression);
                    filter.filterBlocks.getItemAt(0).filterExpression = newFilterExpression;
                    //console.log("FilterExp: ", filterExpression)
                    hotellBIM.filters = [filter];
                    // when cloning the filter keeps the id, but this is set in case the filter was reset
                    hotellBIM.activeFilterId = filter.id;
                });

                // reset the filter by setting the activeFilterId to null
                document
                    .getElementById("filterReset")
                    .addEventListener("click", function() {
                        hotellBIM.activeFilterId = null;
                    });



                view.ui.add("menu", "bottom-right");

                const sliceButton = document.getElementById("slice");
                view.ui.add(sliceButton, "top-right");
                let sliceWidget = null;

                sliceButton.addEventListener("click", function() {
                    if (sliceWidget) {
                        sliceWidget.destroy();
                        sliceWidget = null;
                        sliceButton.classList.remove("active");
                    } else {
                        sliceWidget = new Slice({
                            view: view
                        });
                        sliceWidget.viewModel.newSlice();
                        // programmatically add layers that should be excluded from slicing
                        sliceWidget.viewModel.excludedLayers.addMany(excludedLayers);
                        view.ui.add(sliceWidget, "top-right");
                        sliceButton.classList.add("active");
                    }
                });
            });
        document
            .getElementById("color")
            .addEventListener("change", function(event) {
                if (event.target.checked) {
                    // A renderer can be set on a BuildingComponentSublayer
                    doorsLayer.renderer = {
                        type: "unique-value", // autocasts as new UniqueValueRenderer()
                        field: "AssemblyDesc",
                        uniqueValueInfos: [{
                            // All interior doors are displayed red
                            value: "Interior Doors",
                            symbol: {
                                type: "mesh-3d", // autocasts as new MeshSymbol3D()
                                symbolLayers: [{
                                    type: "fill", // autocasts as new FillSymbol3DLayer()
                                    material: {
                                        color: "red"
                                    }
                                }]
                            }
                        }]
                    };
                } else {
                    doorsLayer.renderer = null;
                }


            });
    </script>



</body>


</html>