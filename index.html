<!DOCTYPE html>
<html>


<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Digital tvilling - Geodata</title>


    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Load the Chart.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
    <script src="moment.js"></script>

    <link rel="stylesheet" href="https://js.arcgis.com/4.12/esri/themes/light/main.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css" />
    <script src="https://js.arcgis.com/4.12/"></script>

</head>


<body>
        <button class="esri-button" id="slice" type="button" title="Slice layers">
                Skj√¶re i bygg
              </button>
    <div id="viewDiv">


        <!-- <div class="ui raised very padded text container segment minContainer">
            <h2 class="ui header">Sensor historikk</h2>

            <button class="circular ui icon button pkt" id="point-geometry-button" value="point" title="Historiske data">
                <i class="map pin icon"></i>
            </button>

            <button class="circular ui icon button omr" id="point-geometry-button" value="point" title="Historiske data">
                    <i class="minus icon"></i>
                </button>

            <button class="circular ui icon button omr" id="point-geometry-button" value="point" title="Historiske data">
                    <i class="map icon"></i>
                </button>

        </div> -->
        

        <div style="width: 250px; height: 130px; position: absolute; left: 20px; bottom: 20px; background-color: #33A7B7; opacity: 0.8; padding: 20px;">
            <h2 style="color: rgba(249, 245, 245, 0.87)">Sensor historikk</h2>

            <button class="circular ui icon button pkt" id="point-geometry-button" value="point" title="Historiske data">
                    <i class="map pin icon"></i>
                </button>

            <button class="circular ui icon button omr" id="point-geometry-button" value="point" title="Historiske data">
                        <i class="minus icon"></i>
                    </button>

            <button class="circular ui icon button omr" id="point-geometry-button" value="point" title="Historiske data">
                        <i class="map icon"></i>
                    </button>

        </div>



        <div id="resultDiv" class="esri-widget esri-widget--panel">
            <i id="closeIcon" onClick="closeHistoricalData()" class="close icon"></i>
            <div class="roomName" id="roomName"></div>
            <div class="charts">
                <div>
                    <canvas id="year-chart" height="250" width="400" />
                </div>
                <div>
                    <canvas id="temp-chart" width="400" height="400" />
                </div>
            </div>
            <div id="typeBilde">
                <div class="typeText">
                    <p></p>
                    Sensor i valgte rom
                </div>
                <img id="tempImg" src="icon/Temp.png" alt="Temp">
                <img id="touchImg" src="icon/Touch.png" alt="Touch">
                <img id="proxImg" src="icon/Prox.png" alt="Prox">
            </div>
        </div>
    </div>




    <script>
        require([
                "esri/Map",
                "esri/WebScene",
                "esri/views/SceneView",
                "esri/Basemap",
                "esri/layers/Layer",
                "esri/layers/SceneLayer",
                "esri/layers/BuildingSceneLayer",
                "esri/layers/FeatureLayer",
                "esri/layers/ElevationLayer",
                "esri/layers/GraphicsLayer",
                "esri/widgets/Sketch/SketchViewModel",
                "esri/symbols/WebStyleSymbol",
                "esri/views/layers/support/FeatureFilter",
                "esri/geometry/geometryEngine",
                "esri/Graphic",
                "esri/renderers/ClassBreaksRenderer",
                "esri/widgets/Slider",
                "esri/core/promiseUtils",
                "esri/widgets/LayerList",
                "esri/widgets/Expand",
                "esri/widgets/Slice",
            ],
            function(Map, WebScene, SceneView, Basemap, Layer, SceneLayer, BuildingSceneLayer, FeatureLayer, ElevationLayer, GraphicsLayer, SketchViewModel, WebStyleSymbol, Graphic, geometryEngine, FeatureFilter, ClassBreaksRenderer, Slider, promiseUtils, LayerList, Expand, Slice) {


                const defExpression = "byggnr <> 81809542 AND byggnr <> 81809569 AND byggnr <> 81809488 AND byggnr <> 300229671";
                const defExpressionHiglight = "byggnr = 81809542 or byggnr = 81809569 or byggnr = 81809488 or byggnr = 80725728 or byggnr = 80772092 or byggnr = 80835337 or byggnr = 81050821 or byggnr = 81097607";


                //-------------------RENDERS------------------------------------------------------


                //--------Polyrendrer - Simple---------------------
                var polyrend = {
                    type: "simple",
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()

                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#f44141",

                            },
                            edges: {
                                type: "solid",
                                color: "#4d5b18",
                                size: 1.5
                            },
                            size: 5.6,
                            opacity: 0.8
                        }]
                    }
                };
                //-------------------------------------------------------------------------------

                //--------Polyrendrer - Edge---------------------
                var EdgeRenderer = {
                    type: "simple", // autocasts as new SimpleRenderer()
                    // Add a default MeshSymbol3D. The color will be determined
                    // by the visual variables
                    symbol: {
                        type: "mesh-3d",
                        symbolLayers: [{
                            type: "fill",
                            material: {
                                color: [255, 255, 255, 0.3],
                                colorMixMode: "replace"
                            },
                            edges: {
                                type: "solid",
                                color: [0, 0, 0],
                                size: 1.5
                            }
                        }]
                    },
                };

                //-------------------------------------------------------------------------------

                //--------Polyrendrer ROM - prox---------------------
                var NotPresentSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [0, 255, 0, 0.3],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 3
                    }]
                };

                var PresentSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [255, 0, 0, 0.3],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 3
                    }]
                };

                var DisTechRendrerPROX = {
                    type: "unique-value", // autocasts as new UniqueValueRenderer()
                    defaultSymbol: {
                        type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ExtrudeSymbol3DLayer()
                            material: {
                                color: [204, 204, 204, 0.3],
                            },
                            edges: {
                                type: "solid",
                                color: "#333333",
                                size: 1.5
                            },
                            size: 1.5
                        }]
                    },
                    defaultLabel: "Other",
                    field: "Status",
                    uniqueValueInfos: [{
                        value: "PRESENT",
                        symbol: PresentSymbol,
                        label: "PresentSymbol"
                    }, {
                        value: "NOT_PRESENT",
                        symbol: NotPresentSymbol,
                        label: "NOT_PRESENT"
                    }],

                };
                //-----------------------------------------------

                //--------Polyrendrer ROM - Booking---------------------   
                var LedigSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [87, 214, 141, 0.8],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 3
                    }]
                };

                var OpptattSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [192, 57, 43, 0.8],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 3
                    }]
                };
                var RomBooking = {
                    type: "unique-value", // autocasts as new UniqueValueRenderer()
                    defaultSymbol: {
                        type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ExtrudeSymbol3DLayer()
                            material: {
                                color: [204, 204, 204, 0.8],
                            },
                            edges: {
                                type: "solid",
                                color: "#333333",
                                size: 1.5
                            },
                            size: 1.5
                        }]
                    },
                    defaultLabel: "Other",
                    field: "Tilgjengelighet",
                    uniqueValueInfos: [{
                        value: "Opptatt",
                        symbol: OpptattSymbol,
                        label: "OpptattSymbol"
                    }, {
                        value: "Ledig",
                        symbol: LedigSymbol,
                        label: "LedigSymbol"
                    }],

                };
                //-----------------------------------------------


                //--------Polyrendrer Plass - prox---------------------
                var NotPresentSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [0, 255, 0, 0.3],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 1.5
                    }]
                };

                var PresentSymbol = {
                    type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                    symbolLayers: [{
                        type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                        material: {
                            color: [255, 0, 0, 0.3],
                        },
                        edges: {
                            type: "solid",
                            color: "#333333",
                            size: 1.5
                        },
                        size: 1.5
                    }]
                };

                var DisTechRendrerPROXplass = {
                    type: "unique-value", // autocasts as new UniqueValueRenderer()
                    defaultSymbol: {
                        type: "polygon-3d", // autocasts as new PolygonSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ExtrudeSymbol3DLayer()
                            material: {
                                color: [204, 204, 204, 0.3],
                            },
                            edges: {
                                type: "solid",
                                color: "#333333",
                                size: 1.5
                            },
                            size: 1.5
                        }]
                    },
                    defaultLabel: "Other",
                    field: "status",
                    uniqueValueInfos: [{
                        value: "PRESENT",
                        symbol: PresentSymbol,
                        label: "PresentSymbol"
                    }, {
                        value: "NOT_PRESENT",
                        symbol: NotPresentSymbol,
                        label: "NOT_PRESENT"
                    }],

                };
                //-----------------------------------------------


                //--------Polyrendrer - Temp---------------------
                var FlateRendererDistTech = new ClassBreaksRenderer({
                    // type: "class-breaks",
                    // attribute of interest - Earthquake magnitude
                    valueExpression: "if ( $feature.ETASJE_TOPOLOGISK == 2) {return 0} else {return $feature.Temp}"
                });

                // All features with magnitude between 0 - 4.0
                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 0.0,
                    maxValue: 1.0,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#4286f4"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 1.0,
                    maxValue: 1.75,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#ec1d23"
                            },
                            size: 5.6
                        }]
                    }
                });

                // All features with magnitude between 4.1 - 7.0
                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 1.76,
                    maxValue: 2.5,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#f37b7d"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 23,
                    maxValue: 24.5,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#42f480"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererDistTech.addClassBreakInfo({
                    minValue: 24.6,
                    maxValue: 50,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#e50d18"
                            },
                            size: 5.6
                        }]
                    }
                });



                var FlateRendererNordigi = new ClassBreaksRenderer({
                    // type: "class-breaks",
                    // attribute of interest - Earthquake magnitude
                    valueExpression: "if ( $feature.ETASJE_TOPOLOGISK == 2) {return 0} else {return $feature.Temp}"
                });

                // All features with magnitude between 0 - 4.0
                FlateRendererNordigi.addClassBreakInfo({
                    minValue: 0.0,
                    maxValue: 10,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#4286f4"
                            },
                            size: 5.6
                        }]
                    }
                });

                FlateRendererNordigi.addClassBreakInfo({
                    minValue: 10.1,
                    maxValue: 100,
                    symbol: {
                        type: "polygon-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "extrude", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "#ec1d23"
                            },
                            size: 5.6
                        }]
                    }
                });
                //-----------------------------------------------

                //--------ekisterendeBygg---------------------
                var solidEdges = {
                    type: "solid",
                    color: [0, 0, 0, 0.6],
                    size: 1
                };

                var byggRenderer = {
                    type: "simple", // autocasts as new SimpleRenderer()
                    symbol: {
                        type: "mesh-3d",
                        symbolLayers: [{
                            type: "fill",
                            material: {
                                color: "#ffffff",
                                colorMixMode: "replace"
                            },
                            edges: solidEdges
                        }]
                    },
                };

                var byggRendererHiglight = {
                    type: "simple", // autocasts as new SimpleRenderer()
                    symbol: {
                        type: "mesh-3d",
                        symbolLayers: [{
                            type: "fill",
                            material: {
                                color: "#42ebf4",
                                colorMixMode: "replace"
                            },
                            edges: solidEdges
                        }]
                    },
                };



                //---------------------------------------------------------------------------------

                //--------PersonRendrer---------------------


                var verticalOffset = {
                    screenLength: 2000,
                    maxWorldLength: 150,
                    minWorldLength: 4
                };


                function getUniqueValueSymbol(name, color) {
                    // The point symbol is visualized with an icon symbol. To clearly see the location of the point
                    // we displace the icon vertically and add a callout line. The line connects the offseted symbol with the location
                    // of the point feature.
                    return {
                        type: "point-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "icon", // autocasts as new IconSymbol3DLayer()
                            resource: {
                                href: name
                            },
                            size: 50,
                            outline: {
                                color: "white",
                                size: 10
                            }
                        }],

                        verticalOffset: verticalOffset,

                        callout: {
                            type: "line", // autocasts as new LineCallout3D()
                            color: "white",
                            size: 2,
                            border: {
                                color: color
                            }
                        }
                    };
                }

                var pointsRenderer = {
                    type: "unique-value", // autocasts as new UniqueValueRenderer()
                    field: "Stasjonsnavn",
                    uniqueValueInfos: [{
                        value: 1,
                        symbol: getUniqueValueSymbol("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAADAFBMVEVHcEw0cYAzcYAzcYEzcYA0cYEycYAzcYAzcYBBfYMzcYAycYAzcYAzcYYzcYAzcYA0coAzcYAzZpk7fYMzcYEzcYAzcoAzcYEzcYEzcYAzcYAycYAzcYAzcoEzcYAzcIE5cY4zcoEycoEwboMycoA0cYEycIAycYAzcIAzcoIzcYAwcIAzcYDbtibpwpzOnwm8iwDtySzgtQDv0E/Nngh/RwQ1cn/btSSZWwg4c3zowZtYgYWaiCaGTQTZsyN7hkjYsSDlwJukZDSseQfVriCXnpDryCjctF69jAKCSAU8dXqIk0FuhVrguF/Mpx7UqRXWrBnnwJjNohTSqxzjvijethHMnQjhtwK5rV7oyEHmwiqzfQWlbwaumiu0ojLPriaSkD1HeoNff1/PoQvPt5jRpA67rjbUsAk5dIFAdnfHmg1Ne4GUk1jSpxJGdnJKd3zDlQhhhGeNllCYm0rethbmv5G2ikXFlSvdtirXsiXJnhDXrx2Di0i8hVh/iEfmv4zvz0Zmg2C1q5Ttyi7WtY24lii/kASlurE/doK5v7tniIh5kIrnwIXlv3yXiG+gchDIpSDEqCp6jFPBoiKLkUiimjyOkkiKmI2NmY7QpxmsoSZcgGV/jWV2iVZFeXusp5OMlG97jnFagXVph1iVnUmuqJOgnC+/sDSWlkK1ek1rhGqnaDmwnyveuYOUlm5jhFzbvSretGSOkF/TuSygl13iuXeDkUXVrF+Jl06vmTNMenSKd2XQp17SqSzZuyrkvJWOWBSIUQnguIC5ihC0qzndsYnJtjK6jgvjuw2nmVt/fHhKRkDowRvuyzeulkOnZzi9po9bW1rCo4W+qUnPpSm2sYzZsGeNemZWe2aFd2q5mh6vnlO2tJeucUOCcWHtyS+wuqxAPTpMR0G8igDiuoXEp2K4vLG3kRdZgXvQsXzIqIjBq3TnwyqqkHiQkI/Pn3WupmmqcgTlvJawvr6naDOaj4PbsXKtcjXZtpTCjk62rXzClxfVq16mdS+gi26bZyY3Y6pBAAAALHRSTlMAy/hdziZR/e8D/qbREoTfgOIFB0DHkzpk8t1V0mj7fQlEPCXKT5gkli/VEH9p+MUAAARgSURBVFjDY2CgFeBlE+BmEeTg4uIQZOEWYOMlTTcrHwu7DgpgZ+FjJVa3EDOjDlYgysxJjHZZfh2cgF+WoBFKMjp4AY8SXu0Kalw6BACXhjCesONBVZy540jksW3rLVFFtTRx6VeURFFomeZmeNbY8IRRurcZioSkCHb9bEwoyrw2GBoaNhgbnjEyMpqF6ggmaWz6pdFiPs0QYoAb0AAjb7RUwYapXwTVfh0vN5ABxlAD0tHCgUkRI/wk0UJ7iSHUAEOQAUaL0aQ5lFH1C7OgR9dykP5muAHe6PIyCigGqGHE92a4AeEgA5ZhKBBDSX+Y6WcfyID7cAPWYKYocYR+Th502cLiipCQkKioyMg3UaGhoSUlLsWFGJ4Qghsgi2F8kS4GKMJQJAvPgJj5z6ys/EolQnPF3vIyMwxFUrCsyYyZZczOOzk5ffn+81tvb09PfaDe/pWrMQ3QYYYaoIIple/kdLf2/Sc9OAiszcdSwkDTEJZMm300EKjr7dcfenotNy+ATLDKxqIMUsrxYZHJAFv78F2fnt71i6fAnAwsyvjABvBgKzdSQHruPXqlp3fp9G4QOwWbKkZw+c2OTcpVDw24YlPFDirt2bCWXImOqPodE7EqA2VrAexl3wxUA6ZjVyUPNIAbu5TZUmT983EUsdxAA1hwyJm5WsG0W7ma4VAECkVBnCW4dRM4IBybrHEqEQQawIGnEujo6u7u6sCjgANogBwuyRt1NS+sQaDRp9EShxo53Abk+enqmreCvPC6WlfXbgVuA3B4Aahf18XjJTAIbgWAcvQ0nF7AHogJIE3BBs/19G7r+4PYlZa4AhF7NAaDNAUZGDxtqdLPBRcqk3BFI9aElATWU2VgcHynvn4qmBOHKyFhTcqxYD1ZBgYGJvr6+mBOPK6kjDUzTQDrKQAaANSvbwfi2GFTp4orO7uADfCAGuAA5uXhyM7YQtHLHGynAdQL4HjU9cFUp4KrSPMB63CBGQCOR90pmOoEcBWq4FSgO9MA6gVIPE7FVagyMOKIhCCYC3DFoyjOimUyPBbBBiSDuRNxViyYVZsfLBZbr4IM0DfHmhDgVRtm5QqJxTYDg847EZdh8ViJrkoCd/UO1mAO9MCzB+0RQAOqwXz06h2p2SuO2sCwNIfGokdne0QQPCFkoiYiceQmigaWrBRsYPDr8wdwGEASwmzcTRy0RlYNWP3vmP5/ff3OIHAYLDAXpdWtgKeZl+MOBH/+msLBgT3bfX195yAXRer4GpqrwLXBf08gsAWDg+AqYhG+hiZqU/cQqDaJtgACgzBQGOjXAwXW4m/qojS2NwFtfIJswFaggQsJNLaBvkAU0FtK9a49/hgTEw01YKNe6QKE/0VwdRiUEXGx6+Q5GzCosweBnHXz4FIs6ri7LMJiBLs87GLCeHtNmioEOl3ihLptnBJSuLVLSRDTc+RkFqWk4wnt+jKid30ZBZRJ7HyrynMz8nOws3PwM3LLq2rTrJcPAFLHdWYOUZ1KAAAAAElFTkSuQmCC", "#42f4a4")

                    }]
                };


                //---------------------------------------------------------------------------------



                //-----------------------LAG------------------------------------------------------

                const sketchLayer = new GraphicsLayer();





                const geodataDigitaltvilling_kursrom_PROX_sensor = new FeatureLayer({
                        url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/Kursplass/FeatureServer",
                        title: "Kursplasser",
                        visible: false,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: DisTechRendrerPROXplass,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_rom_etg01 = new FeatureLayer({
                        url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/S28_All_Sensors/FeatureServer",
                        title: "Sensorer",
                        visible: false,
                        definitionExpression: "SensorID_Touch NOT LIKE '' OR SensorID_Temp NOT LIKE '' OR SensorID NOT LIKE '' OR Brukstype NOT LIKE 'Elbil lader'",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_rom_kjeller = new FeatureLayer({
                    url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/S28_All_Sensors/FeatureServer",
                    title: "Sensorer P-plass",
                    visible: false,
                    definitionExpression: "Brukstype LIKE 'Elbil lader'",
                    outFields: ["*"],
                    purgeOptions: {
                        displayCount: 1000
                    },
                    renderer: DisTechRendrerPROX,
                    //popupTemplate: template,
                    refreshInterval: 0.01,
                    elevationInfo: {
                        // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                        mode: "absolute-height",
                        offset: 0
                    },

                }

            );

                const geodataDigitaltvilling_rom_etg01_booking = new FeatureLayer({
                        url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/S28_All_Sensors/FeatureServer",
                        title: "Rom booking -- Sensor",
                        visible: false,
                        definitionExpression: "Tilgjengelighet NOT LIKE ''",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: RomBooking,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const personDigitaltvilling = new FeatureLayer({
                        url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/PersonerDigitalTvilling/FeatureServer",
                        title: "Arbeidere",
                        listMode: "hide",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: pointsRenderer,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 0
                        },

                    }

                );

                const Plasser = new FeatureLayer({
                        url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/ArcGIS/rest/services/Arbeidsplass_Poly/FeatureServer/0",
                        title: "Arbeidsplasser -- Sensor",
                        visible: false,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: DisTechRendrerPROXplass,
                        opacity: 0.8,

                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                // const geodataDigitaltvilling_rom = new SceneLayer({
                //         url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Rom_Massiv/SceneServer",
                //         title: "Vegger",
                //         listMode: "hide",
                //         outFields: ["*"],
                //         purgeOptions: {
                //             displayCount: 1000
                //         },
                //         renderer: EdgeRenderer,
                //         //popupTemplate: template,
                //         refreshInterval: 0.01,
                //         elevationInfo: {
                //             // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                //             mode: "absolute-height",
                //             offset: 2.8
                //         },

                //     }

                // );





                const geodataDigitaltvilling_dtBygning = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/DigitalTvilling_DT/SceneServer",
                        title: "DT-hovedkvarter",
                        visible: false,
                        listMode: "hide",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 18
                        },

                    }

                );

                const geodataDigitaltvilling_gulv = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Gulv/SceneServer",
                        title: "Gulv",
                        outFields: ["*"],
                        listMode: "hide",
                        visible: false,
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_spiler = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_spiler/SceneServer",
                        title: "Spiler",
                        outFields: ["*"],
                        listMode: "hide",
                        visible: false,
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_tynnvegg = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Tynnvegg/SceneServer",
                        title: "Lettvegg",
                        listMode: "hide",
                        outFields: ["*"],
                        visible: false,
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_innevegg = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_InneVegg/SceneServer",
                        title: "Innervegg",
                        outFields: ["*"],
                        listMode: "hide",
                        visible: false,
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_yttervegg = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Yttervegg/SceneServer",
                        title: "Yttervegg",
                        outFields: ["*"],
                        listMode: "hide",
                        visible: false,
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_yttervegglass = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_YtterveggGlass/SceneServer",
                        title: "Yttervegg - Glass",
                        outFields: ["*"],
                        listMode: "hide",
                        visible: false,
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );


                const geodataDigitaltvilling_plan = new BuildingSceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/S28_03/SceneServer",//"https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_plan/SceneServer",
                        title: "BIM - S28",
                        visible: true,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 0
                        },

                    }

                );

                const geodataDigitaltvilling_langbord = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_langbord/SceneServer",
                        title: "Langbord",
                        visible: false,
                        listMode: "hide",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_WC = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_WC/SceneServer",
                        title: "WC",
                        listMode: "hide",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_Trapp = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Trapp/SceneServer",
                        title: "Trapp",
                        listMode: "hide",
                        visible: false,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_Soyler = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_S%C3%B8yler/SceneServer",
                        title: "S√∏yler",
                        listMode: "hide",
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_Planter = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Planter/SceneServer",
                        title: "Planter",
                        listMode: "hide",
                        visible: false,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_Bokhylle = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Bokhylle/SceneServer",
                        title: "Bokhylle",
                        listMode: "hide",
                        visible: false,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_reception = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Reception/SceneServer",
                        title: "Reception",
                        listMode: "hide",
                        visible: false,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const geodataDigitaltvilling_Arbeidsplass = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/2JyTvMWQSnM2Vi8q/arcgis/rest/services/geodataDigitaltvilling_Arbeidsplass/SceneServer",
                        title: "Arbeidsbord",
                        listMode: "hide",
                        visible: false,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        //renderer: DisTechRendrerPROX,
                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "absolute-height",
                            offset: 2.8
                        },

                    }

                );

                const Bygninger_Norge_Oslo = new SceneLayer({
                        url: "https://tiles.arcgis.com/tiles/PdUYt91ohJfR04kk/arcgis/rest/services/Bygninger_Norge_OsloSommerkonf_20180730_124537/SceneServer",
                        title: "Bygninger",
                        listMode: "hide",
                        definitionExpression: defExpression,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: byggRenderer,
                        opacity: 0.3,

                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "on-the-ground",
                            //offset: 2.8
                        },

                    }

                );

                const Bygninger_Norge_Oslo_highligted = new SceneLayer({
                        url: "https://utility.arcgis.com/usrsvcs/servers/d10b1ff653234cd08a3fc7da78820a14/rest/services/geoscene/GeosceneBygning/SceneServer",
                        title: "Mine bygg",
                        listMode: "hide",
                        definitionExpression: defExpressionHiglight,
                        outFields: ["*"],
                        purgeOptions: {
                            displayCount: 1000
                        },
                        renderer: byggRendererHiglight,
                        //opacity: 0.3,

                        //popupTemplate: template,
                        refreshInterval: 0.01,
                        elevationInfo: {
                            // elevation mode that will place points on top of the buildings or other SceneLayer 3D objects
                            mode: "on-the-ground",
                            //offset: 2.8
                        },

                    }

                );




                var basemap = new Basemap({
                    portalItem: {
                        id: "a1f189886ef54c5b8e03e37695e8925d" // WGS84 Streets Vector webmap
                    }
                });

                var elevLyr = new ElevationLayer({
                    portalItem: {
                        id: "4526a4d94b844467a3ce130da8ca172d"
                    }
                });

                const gLayer = new GraphicsLayer();

                var map = new Map({
                    basemap: basemap,
                    //ground: "world-elevation",
                    layers: [geodataDigitaltvilling_rom_kjeller, geodataDigitaltvilling_reception, geodataDigitaltvilling_dtBygning, geodataDigitaltvilling_yttervegglass, geodataDigitaltvilling_yttervegg, geodataDigitaltvilling_innevegg, geodataDigitaltvilling_tynnvegg, geodataDigitaltvilling_spiler, geodataDigitaltvilling_gulv, Plasser, geodataDigitaltvilling_rom_etg01_booking, personDigitaltvilling, Bygninger_Norge_Oslo_highligted, geodataDigitaltvilling_rom_etg01, geodataDigitaltvilling_kursrom_PROX_sensor, Bygninger_Norge_Oslo, geodataDigitaltvilling_plan, geodataDigitaltvilling_Arbeidsplass, geodataDigitaltvilling_Bokhylle, geodataDigitaltvilling_Planter, geodataDigitaltvilling_Soyler, geodataDigitaltvilling_Trapp, geodataDigitaltvilling_WC, geodataDigitaltvilling_langbord],
                    ground: {
                        //surfaceColor: "#2A282B"
                    }
                });


                map.ground.layers.add(elevLyr);

                var view = new SceneView({
                    container: "viewDiv",
                    map: map,
                    alphaCompositingEnabled: true,
                    environment: {
                        // background: {
                        //     type: "color", // autocasts as new ColorBackground()
                        //     color: "#2A282B"
                        // },
                        // disable stars
                        starsEnabled: false,
                        //disable atmosphere
                        atmosphereEnabled: true
                    },
                    qualityProfile: "high",
                    center: {
                        x: 263164.68078,
                        y: 6649010.9098,
                        z: 100,
                        spatialReference: 25833
                    },
                    qualityProfile: "high"

                });

                view.when(function() {
                    var layerList = new LayerList({
                        view: view
                    });

                    var bgExpand = new Expand({
                        view: view,
                        content: layerList
                    });


                    // Add widget to the top right corner of the view
                    view.ui.add(bgExpand, "top-left");
                });


                //-----------------Graf/statestikkWidget------------------------

                var yearChart = null;
                var tempChart = null;

                // use SketchViewModel to draw polygons that are used as a query
                let sketchGeometry = null;
                const sketchViewModel = new SketchViewModel({
                    layer: sketchLayer,
                    defaultUpdateOptions: {
                        tool: "reshape",
                        toggleToolOnClick: false
                    },
                    view: view
                });

                sketchViewModel.on("create", function(event) {
                    if (event.state === "complete") {
                        sketchGeometry = event.graphic.geometry;
                        runQuery();
                    }
                });

                sketchViewModel.on("update", function(event) {
                    if (event.state !== "cancel" && event.graphics.length) {
                        sketchGeometry = event.graphics[0].geometry;
                        runQuery();
                    }
                });

                // draw geometry buttons - use the selected geometry to sktech
                document
                    .getElementById("point-geometry-button")
                    .addEventListener("click", geometryButtonsClickHandler);

                function geometryButtonsClickHandler(event) {
                    const geometryType = event.target.value;
                    //clearGeometry();
                    sketchViewModel.create(geometryType);
                }

                // set the geometry query on the visible SceneLayerView
                var debouncedRunQuery = promiseUtils.debounce(function() {
                    if (!sketchGeometry) {
                        return;
                    }

                    resultDiv.style.display = "block";
                    return promiseUtils.eachAlways([
                        queryStatistics(),
                        //updateSceneLayer()
                    ]);
                });

                function runQuery() {
                    debouncedRunQuery().catch((error) => {
                        if (error.name === "AbortError") {
                            return;
                        }

                        console.error(error);
                    });
                }

                // Set the renderer with objectIds
                var highlightHandle = null;

                function clearHighlighting() {
                    if (highlightHandle) {
                        highlightHandle.remove();
                        highlightHandle = null;
                    }
                }

                function highlightBuildings(objectIds) {
                    // Remove any previous highlighting
                    clearHighlighting();
                    const objectIdField = geodataDigitaltvilling_rom_etg01.objectIdField;
                    document.getElementById("count").innerHTML = objectIds.length;

                    highlightHandle = geodataDigitaltvilling_rom_etg01.highlight(objectIds);
                }

                function updateSceneLayer() {
                    const query = geodataDigitaltvilling_rom_etg01.createQuery();
                    query.geometry = sketchGeometry;
                    return geodataDigitaltvilling_rom_etg01.queryObjectIds(query).then(highlightBuildings);
                }

                function queryStatistics() {
                    const statDefinitions = [{
                            onStatisticField: "CASE WHEN (date >= '2019-08-15' AND date <= '2019-07-21' AND Status = 'PRESENT') THEN 1 ELSE 0 END",
                            outStatisticFieldName: "uke29",
                            statisticType: "sum"
                        }, {
                            onStatisticField: "CASE WHEN (date >= '2019-07-22' AND date <= '2019-07-28' AND Status = 'PRESENT') THEN 1 ELSE 0 END",
                            outStatisticFieldName: "uke30",
                            statisticType: "sum"
                        }, {
                            onStatisticField: "CASE WHEN (date >= '2019-07-29' AND date <= '2019-08-04' AND Status = 'PRESENT') THEN 1 ELSE 0 END",
                            outStatisticFieldName: "uke31",
                            statisticType: "sum"
                        }, {
                            onStatisticField: "CASE WHEN (date >= '2019-08-05' AND date <= '2019-08-11' AND Status = 'PRESENT') THEN 1 ELSE 0 END",
                            outStatisticFieldName: "uke32",
                            statisticType: "sum"
                        }, {
                            onStatisticField: "CASE WHEN (date >= '2019-08-12' AND date <= '2019-08-18' AND Status = 'PRESENT') THEN 1 ELSE 0 END",
                            outStatisticFieldName: "uke33",
                            statisticType: "sum"
                        }, {
                            onStatisticField: "CASE WHEN (date >= '2019-08-19' AND date <= '2019-08-25' AND Status = 'PRESENT') THEN 1 ELSE 0 END",
                            outStatisticFieldName: "uke34",
                            statisticType: "sum"
                        }
                        //  {
                        //     onStatisticField: "CASE WHEN (date >= '2019-08-12' AND date <= '2019-08-18' AND Temp = 'PRESENT') THEN 1 ELSE 0 END",
                        //     outStatisticFieldName: "uke33",
                        //     statisticType: "sum"
                        // },
                    ];

                    const query = geodataDigitaltvilling_rom_etg01.createQuery();
                    query.geometry = sketchGeometry;

                    geodataDigitaltvilling_rom_etg01.queryFeatures(query).then(function(result) {
                        const guid = result.features[0].attributes.GlobalID;

                        // Set visible sensorImages based on attributes
                        const feature = result.features[0].attributes;
                        var proxImg = document.getElementById('proxImg');
                        var tempImg = document.getElementById('tempImg');
                        var touchImg = document.getElementById('touchImg');
                        proxImg.style.visibility = feature.SensorID === null ? proxImg.classList.add('sensorNotPresent') : proxImg.classList.remove('sensorNotPresent');
                        tempImg.style.visibility = feature.SensorID_Temp === null ? tempImg.classList.add('sensorNotPresent') : tempImg.classList.remove('sensorNotPresent');
                        touchImg.style.visibility = feature.SensorID_Touch === null ? touchImg.classList.add('sensorNotPresent') : touchImg.classList.remove('sensorNotPresent');

                        // Set roomname
                        document.getElementById('roomName').innerHTML = feature.Romnavn;

                        //Get proximity values
                        const proxLayer = new FeatureLayer({
                            url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/S28_All_Sensors/FeatureServer/2"
                        });

                        const query2 = proxLayer.createQuery();
                        query2.where = `RomGUID = '${guid}'`;
                        query2.outStatistics = statDefinitions;

                        proxLayer.queryFeatures(query2).then(function(result) {
                            const allStats = result.features[0].attributes;

                            updateChart(yearChart, [
                                allStats.uke29,
                                allStats.uke30,
                                allStats.uke31,
                                allStats.uke32,
                                allStats.uke33,
                                allStats.uke34,
                            ]);

                        }, console.error);

                        // Get temperature values
                        const tempLayer = new FeatureLayer({
                            url: "https://services.arcgis.com/2JyTvMWQSnM2Vi8q/arcgis/rest/services/S28_All_Sensors/FeatureServer/3"
                        });

                        const query3 = tempLayer.createQuery();

                        var currentTime = new Date();
                        var twoWeeksAgo = currentTime.setDate(currentTime.getDate() - 14);

                        query3.where = `RomGUID = '${guid}' AND date >= '2019-08-22'`;

                        tempLayer.queryFeatures(query3).then(function(result) {
                            const allStats = result.features;

                            updateTempChart(tempChart, allStats);

                        }, console.error);
                    }, console.error);
                }

                // Updates the given chart with new data
                function updateChart(chart, dataValues) {
                    if (dataValues[0] === null) {
                        document.getElementById('year-chart').style.display = 'none';
                    } else {
                        document.getElementById('year-chart').style.display = 'block';
                        chart.data.datasets[0].data = dataValues;
                        chart.update();
                    }
                }

                function updateTempChart(chart, dataValues) {
                    if (dataValues.length === 0) {
                        document.getElementById('temp-chart').style.display = 'none';
                    } else {
                        document.getElementById('temp-chart').style.display = 'block';
                        chart.data.labels = dataValues.map((dv) => {
                            return moment(dv.attributes.Date).format("HH" + ".00");
                        });
                        chart.data.datasets[0].data = dataValues.map((dv) => {
                            return dv.attributes.Temp;
                        });
                        chart.update();
                    }

                }

                function createYearChart() {
                    const yearCanvas = document.getElementById("year-chart");
                    yearChart = new Chart(yearCanvas.getContext("2d"), {
                        type: "horizontalBar",
                        data: {
                            labels: [
                                "29",
                                "30",
                                "31",
                                "32",
                                "33",
                                "34"
                            ],
                            datasets: [{
                                label: "Antall bes√∏k per uke",
                                backgroundColor: "#149dcf",
                                stack: "Stack 0",
                                data: [0, 0, 0, 0, 0, 0]
                            }]
                        },
                        options: {
                            responsive: false,
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: "Antall bes√∏k per uke"
                            },
                            scales: {
                                xAxes: [{
                                    stacked: true,
                                    ticks: {
                                        beginAtZero: true,
                                        precision: 0
                                    }
                                }],
                                yAxes: [{
                                    stacked: true
                                }]
                            }
                        }
                    });
                }

                function createTempChart() {
                    const tempCanvas = document.getElementById("temp-chart");
                    tempChart = new Chart(tempCanvas.getContext("2d"), {
                        type: "line",
                        data: {
                            labels: [
                                "29",
                                "30",
                                "31",
                                "32",
                                "33",
                                "34"
                            ],
                            datasets: [{
                                label: "Temperatur",
                                backgroundColor: "#2B7A78",
                                stack: "Stack 0",
                                data: [0, 0, 0, 0, 0, 0]
                            }]
                        },
                        options: {
                            responsive: false,
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: "Temperatur"
                            },
                            scales: {
                                xAxes: [{
                                    stacked: true,
                                    ticks: {
                                        display: true,
                                        autoSkip: true,
                                        maxTicksLimit: 7
                                    }
                                }],
                                yAxes: [{
                                    ticks: {
                                        min: 18,
                                        max: 25
                                    }
                                }]
                            }
                        }
                    });
                    const excludedLayers = [];
                    let doorsLayer;

                    geodataDigitaltvilling_plan.when(function() {
                        // Iterate through the flat array of sublayers and extract the ones
                        // that should be excluded from the slice widget
                        geodataDigitaltvilling_plan.allSublayers.forEach(function(layer) {
                          // modelName is standard accross all BuildingSceneLayer,
                          // use it to identify a certain layer
                          switch (layer.modelName) {
                            // Because of performance reasons, the Full Model view is
                            // by default set to false. In this scene the Full Model should be visible.
                            case "FullModel":
                              layer.visible = true;
                              break;
                            case "Overview":
                            case "Roofs":
                            case "Walls":
                            case "Rooms":
                              layer.visible = true;
                              break;
                            // Extract the layers that should not be hidden by the slice widget
                            case "Doors":
                              doorsLayer = layer;
                              excludedLayers.push(layer);
                            case "StructuralColumns":
                            case "Floors":
                            case "Furniture":
                            //case "CurtainWallPanels":
                              excludedLayers.push(layer);
                              break;
                            default:
                              layer.visible = true;
                          }
                        });
                      });

                      view.when(function() {
                        const sliceButton = document.getElementById("slice");
                        view.ui.add(sliceButton, "top-right");
                        let sliceWidget = null;
              
                        sliceButton.addEventListener("click", function() {
                          if (sliceWidget) {
                            sliceWidget.destroy();
                            sliceWidget = null;
                            sliceButton.classList.remove("active");
                          } else {
                            sliceWidget = new Slice({
                              view: view
                            });
                            sliceWidget.viewModel.newSlice();
                            // programmatically add layers that should be excluded from slicing
                            sliceWidget.viewModel.excludedLayers.addMany(excludedLayers);
                            view.ui.add(sliceWidget, "top-right");
                            sliceButton.classList.add("active");
                          }
                        });
                      });
                      document
                      .getElementById("color")
                      .addEventListener("change", function(event) {
                        if (event.target.checked) {
                          // A renderer can be set on a BuildingComponentSublayer
                          doorsLayer.renderer = {
                            type: "unique-value", // autocasts as new UniqueValueRenderer()
                            field: "AssemblyDesc",
                            uniqueValueInfos: [
                              {
                                // All interior doors are displayed red
                                value: "Interior Doors",
                                symbol: {
                                  type: "mesh-3d", // autocasts as new MeshSymbol3D()
                                  symbolLayers: [
                                    {
                                      type: "fill", // autocasts as new FillSymbol3DLayer()
                                      material: {
                                        color: "red"
                                      }
                                    }
                                  ]
                                }
                              }
                            ]
                          };
                        } else {
                          doorsLayer.renderer = null;
                        }
                      });
            
                }
                // function createMaterialChart() {
                //     const materialCanvas = document.getElementById("material-chart");
                //     materialChart = new Chart(materialCanvas.getContext("2d"), {
                //         type: "doughnut",
                //         data: {
                //             labels: ["Concrete", "Brick", "Wood", "Steel", "Other"],
                //             datasets: [{
                //                 backgroundColor: [
                //                     "#FD7F6F",
                //                     "#7EB0D5",
                //                     "#B2E061",
                //                     "#BD7EBE",
                //                     "#FFB55A"
                //                 ],
                //                 borderWidth: 0,
                //                 data: [0, 0, 0, 0, 0]
                //             }]
                //         },
                //         options: {
                //             responsive: false,
                //             cutoutPercentage: 35,
                //             legend: {
                //                 position: "bottom"
                //             },
                //             title: {
                //                 display: true,
                //                 text: "Building Material"
                //             }
                //         }
                //     });
                // }

                function clearCharts() {
                    updateChart(tempChart, [0, 0, 0, 0, 0]);
                    updateChart(yearChart, [0, 0, 0, 0, 0]);
                    document.getElementById("count").innerHTML = 0;
                }

                createYearChart();
                createTempChart();

                //-------------------------------------------------------------------------

                view.watch("scale", function(newValue) {
                    //geodataDigitaltvilling_rom_wc_etg01.renderer = newValue <= 72224 ? simpleRenderer : DisTechRendrerPROX;

                    if (newValue < 1000) {
                        // Bygninger_Norge_Oslo.definitionExpression = defExpression;
                        Bygninger_Norge_Oslo_highligted.visible = false;
                    } else {
                        // Bygninger_Norge_Oslo.definitionExpression = '';
                        Bygninger_Norge_Oslo_highligted.visible = true;
                    }
                });
            });

        function closeHistoricalData() {
            document.getElementById("resultDiv").style.display = "none";
        }
    </script>



</body>


</html>